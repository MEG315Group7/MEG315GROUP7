<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AD-HTC Fuel-Enhanced Gas Power Cycle Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .glass-panel { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .metric-card { transition: all 0.3s ease; }
        .metric-card:hover { transform: translateY(-2px); box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .flow-line { stroke-dasharray: 5,5; animation: dash 20s linear infinite; }
        @keyframes dash { to { stroke-dashoffset: -100; } }
        .pulse-ring { animation: pulse-ring 2s cubic-bezier(0.215, 0.61, 0.355, 1) infinite; }
        @keyframes pulse-ring {
            0% { transform: scale(0.33); }
            80%, 100% { opacity: 0; }
        }
        .loading-overlay {
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(5px);
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #667eea;
            cursor: pointer;
            border-radius: 50%;
        }
        .tab-active { border-bottom: 2px solid #667eea; color: #667eea; }
        .process-node {
            transition: all 0.3s ease;
        }
        .process-node:hover {
            transform: scale(1.05);
            filter: brightness(1.1);
        }
        .heat-flow { animation: heatPulse 3s ease-in-out infinite; }
        @keyframes heatPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-industry text-3xl"></i>
                    <div>
                        <h1 class="text-2xl font-bold">AD-HTC Power Cycle</h1>
                        <p class="text-sm opacity-90">Anaerobic Digestion - Hydrothermal Carbonization Integration</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="loadScenario('base_case')" class="px-4 py-2 bg-white/20 rounded-lg hover:bg-white/30 transition">
                        <i class="fas fa-play mr-2"></i>Run Base Case
                    </button>
                    <button onclick="exportResults()" class="px-4 py-2 bg-white/20 rounded-lg hover:bg-white/30 transition">
                        <i class="fas fa-download mr-2"></i>Export
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto px-6 py-6">
        
        <!-- Navigation Tabs -->
        <div class="flex space-x-6 mb-6 border-b border-gray-200">
            <button onclick="switchTab('dashboard')" id="tab-dashboard" class="tab-active pb-3 px-2 font-medium">Dashboard</button>
            <button onclick="switchTab('parameters')" id="tab-parameters" class="pb-3 px-2 font-medium text-gray-500 hover:text-gray-700">Parameters</button>
            <button onclick="switchTab('thermodynamics')" id="tab-thermodynamics" class="pb-3 px-2 font-medium text-gray-500 hover:text-gray-700">Thermodynamic Charts</button>
            <button onclick="switchTab('scenarios')" id="tab-scenarios" class="pb-3 px-2 font-medium text-gray-500 hover:text-gray-700">Scenarios</button>
            <button onclick="switchTab('optimization')" id="tab-optimization" class="pb-3 px-2 font-medium text-gray-500 hover:text-gray-700">Optimization</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="space-y-6">
            
            <!-- Key Metrics -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="metric-card bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 mb-1">Net Power Output</p>
                            <p class="text-3xl font-bold text-gray-800" id="metric-power">--</p>
                            <p class="text-xs text-green-500 mt-1"><i class="fas fa-arrow-up mr-1"></i>kW</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-bolt text-blue-600 text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="metric-card bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 mb-1">System Efficiency</p>
                            <p class="text-3xl font-bold text-gray-800" id="metric-efficiency">--</p>
                            <p class="text-xs text-green-500 mt-1"><i class="fas fa-percentage mr-1"></i>Overall</p>
                        </div>
                        <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-chart-line text-green-600 text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="metric-card bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 mb-1">Biogas Production</p>
                            <p class="text-3xl font-bold text-gray-800" id="metric-biogas">--</p>
                            <p class="text-xs text-blue-500 mt-1"><i class="fas fa-fire mr-1"></i>m³/day</p>
                        </div>
                        <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-gas-pump text-orange-600 text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="metric-card bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 mb-1">Self-Sufficiency</p>
                            <p class="text-3xl font-bold text-gray-800" id="metric-sufficiency">--</p>
                            <p class="text-xs text-purple-500 mt-1"><i class="fas fa-recycle mr-1"></i>Heat Integration</p>
                        </div>
                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-thermometer-half text-purple-600 text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Process Flow Diagram -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <h3 class="text-lg font-semibold mb-4">Process Flow Diagram</h3>
                <div class="relative h-96 bg-gray-50 rounded-lg overflow-hidden" id="process-flow">
                    <svg width="100%" height="100%" viewBox="0 0 1000 400">
                        <!-- AD Units -->
                        <g class="process-node" onclick="showDetails('ad')">
                            <rect x="50" y="50" width="120" height="80" rx="8" fill="#10b981" stroke="#059669" stroke-width="2"/>
                            <text x="110" y="85" text-anchor="middle" fill="white" font-weight="bold">AD Unit 1</text>
                            <text x="110" y="105" text-anchor="middle" fill="white" font-size="12">1000 kg/day</text>
                        </g>
                        <g class="process-node" transform="translate(0, 100)" onclick="showDetails('ad')">
                            <rect x="50" y="50" width="120" height="80" rx="8" fill="#10b981" stroke="#059669" stroke-width="2"/>
                            <text x="110" y="85" text-anchor="middle" fill="white" font-weight="bold">AD Unit 2</text>
                            <text x="110" y="105" text-anchor="middle" fill="white" font-size="12">1000 kg/day</text>
                        </g>
                        <g class="process-node" transform="translate(0, 200)" onclick="showDetails('ad')">
                            <rect x="50" y="50" width="120" height="80" rx="8" fill="#10b981" stroke="#059669" stroke-width="2"/>
                            <text x="110" y="85" text-anchor="middle" fill="white" font-weight="bold">AD Unit 3</text>
                            <text x="110" y="105" text-anchor="middle" fill="white" font-size="12">1000 kg/day</text>
                        </g>

                        <!-- Manifold -->
                        <g class="process-node" onclick="showDetails('manifold')">
                            <circle cx="280" cy="150" r="40" fill="#f59e0b" stroke="#d97706" stroke-width="2"/>
                            <text x="280" y="155" text-anchor="middle" fill="white" font-weight="bold" font-size="12">Manifold</text>
                        </g>

                        <!-- Flow Lines -->
                        <line x1="170" y1="90" x2="240" y2="130" stroke="#10b981" stroke-width="3" marker-end="url(#arrowhead)" class="flow-line"/>
                        <line x1="170" y1="150" x2="240" y2="150" stroke="#10b981" stroke-width="3" marker-end="url(#arrowhead)" class="flow-line"/>
                        <line x1="170" y1="210" x2="240" y2="170" stroke="#10b981" stroke-width="3" marker-end="url(#arrowhead)" class="flow-line"/>

                        <!-- Combustor -->
                        <g class="process-node" onclick="showDetails('combustor')">
                            <rect x="380" y="110" width="100" height="80" rx="8" fill="#ef4444" stroke="#dc2626" stroke-width="2"/>
                            <text x="430" y="145" text-anchor="middle" fill="white" font-weight="bold">Combustor</text>
                            <text x="430" y="165" text-anchor="middle" fill="white" font-size="10">1400 K</text>
                        </g>

                        <line x1="320" y1="150" x2="380" y2="150" stroke="#f59e0b" stroke-width="4" marker-end="url(#arrowhead)" class="flow-line"/>

                        <!-- Gas Turbine -->
                        <g class="process-node" onclick="showDetails('turbine')">
                            <rect x="530" y="110" width="100" height="80" rx="8" fill="#3b82f6" stroke="#2563eb" stroke-width="2"/>
                            <text x="580" y="145" text-anchor="middle" fill="white" font-weight="bold">Gas Turbine</text>
                            <text x="580" y="165" text-anchor="middle" fill="white" font-size="10">88% Eff</text>
                        </g>

                        <line x1="480" y1="150" x2="530" y2="150" stroke="#ef4444" stroke-width="4" marker-end="url(#arrowhead)" class="flow-line"/>

                        <!-- Generator -->
                        <g class="process-node" onclick="showDetails('generator')">
                            <rect x="680" y="110" width="100" height="80" rx="8" fill="#8b5cf6" stroke="#7c3aed" stroke-width="2"/>
                            <text x="730" y="145" text-anchor="middle" fill="white" font-weight="bold">Generator</text>
                            <text x="730" y="165" text-anchor="middle" fill="white" font-size="10">Electricity</text>
                        </g>

                        <line x1="630" y1="150" x2="680" y2="150" stroke="#3b82f6" stroke-width="4" marker-end="url(#arrowhead)" class="flow-line"/>

                        <!-- Heat Exchanger -->
                        <g class="process-node" onclick="showDetails('hx')">
                            <rect x="530" y="250" width="100" height="80" rx="8" fill="#f97316" stroke="#ea580c" stroke-width="2"/>
                            <text x="580" y="285" text-anchor="middle" fill="white" font-weight="bold">HRSG/HX</text>
                            <text x="580" y="305" text-anchor="middle" fill="white" font-size="10">Heat Recovery</text>
                        </g>

                        <line x1="580" y1="190" x2="580" y2="250" stroke="#ef4444" stroke-width="3" stroke-dasharray="5,5" class="heat-flow"/>

                        <!-- HTC Reactor -->
                        <g class="process-node" onclick="showDetails('htc')">
                            <rect x="380" y="250" width="100" height="80" rx="8" fill="#78350f" stroke="#92400e" stroke-width="2"/>
                            <text x="430" y="285" text-anchor="middle" fill="white" font-weight="bold">HTC Reactor</text>
                            <text x="430" y="305" text-anchor="middle" fill="white" font-size="10">200°C</text>
                        </g>

                        <line x1="530" y1="290" x2="480" y2="290" stroke="#f97316" stroke-width="3" marker-end="url(#arrowhead)" class="heat-flow"/>

                        <!-- Arrow marker -->
                        <defs>
                            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
                            </marker>
                        </defs>
                    </svg>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <h3 class="text-lg font-semibold mb-4">Energy Flow Distribution</h3>
                    <canvas id="energyFlowChart"></canvas>
                </div>
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <h3 class="text-lg font-semibold mb-4">System Performance Metrics</h3>
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Parameters Tab -->
        <div id="parameters" class="hidden space-y-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Gas Turbine Parameters -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fas fa-cog text-blue-500 mr-2"></i>Gas Turbine Parameters
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ambient Temperature (K)</label>
                            <input type="range" id="param-ambient-temp" min="273" max="323" value="298" class="w-full" oninput="updateParamValue('ambient-temp', this.value)">
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>273 K</span>
                                <span id="val-ambient-temp" class="font-bold text-blue-600">298 K</span>
                                <span>323 K</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Pressure Ratio</label>
                            <input type="range" id="param-pressure-ratio" min="3" max="25" step="0.5" value="12" class="w-full" oninput="updateParamValue('pressure-ratio', this.value)">
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>3</span>
                                <span id="val-pressure-ratio" class="font-bold text-blue-600">12</span>
                                <span>25</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Max Turbine Temperature (K)</label>
                            <input type="range" id="param-turbine-temp" min="800" max="1600" value="1400" class="w-full" oninput="updateParamValue('turbine-temp', this.value)">
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>800 K</span>
                                <span id="val-turbine-temp" class="font-bold text-blue-600">1400 K</span>
                                <span>1600 K</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Compressor Efficiency</label>
                            <input type="range" id="param-comp-eff" min="0.75" max="0.95" step="0.01" value="0.85" class="w-full" oninput="updateParamValue('comp-eff', this.value)">
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>75%</span>
                                <span id="val-comp-eff" class="font-bold text-blue-600">85%</span>
                                <span>95%</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Turbine Efficiency</label>
                            <input type="range" id="param-turb-eff" min="0.80" max="0.95" step="0.01" value="0.88" class="w-full" oninput="updateParamValue('turb-eff', this.value)">
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>80%</span>
                                <span id="val-turb-eff" class="font-bold text-blue-600">88%</span>
                                <span>95%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AD & HTC Parameters -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fas fa-leaf text-green-500 mr-2"></i>AD & HTC Parameters
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">AD Feedstock Rate (kg/day)</label>
                            <input type="range" id="param-feedstock" min="1000" max="10000" step="100" value="3000" class="w-full" oninput="updateParamValue('feedstock', this.value)">
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>1000</span>
                                <span id="val-feedstock" class="font-bold text-green-600">3000</span>
                                <span>10000</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">AD Retention Time (days)</label>
                            <input type="range" id="param-retention" min="10" max="40" value="20" class="w-full" oninput="updateParamValue('retention', this.value)">
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>10 days</span>
                                <span id="val-retention" class="font-bold text-green-600">20 days</span>
                                <span>40 days</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">HTC Biomass Rate (kg/day)</label>
                            <input type="range" id="param-htc-biomass" min="100" max="2000" step="50" value="500" class="w-full" oninput="updateParamValue('htc-biomass', this.value)">
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>100</span>
                                <span id="val-htc-biomass" class="font-bold text-green-600">500</span>
                                <span>2000</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">HTC Temperature (K)</label>
                            <input type="range" id="param-htc-temp" min="423" max="573" value="473" class="w-full" oninput="updateParamValue('htc-temp', this.value)">
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>423 K</span>
                                <span id="val-htc-temp" class="font-bold text-green-600">473 K</span>
                                <span>573 K</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex justify-center">
                <button onclick="runCalculation()" class="px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center space-x-2 shadow-lg">
                    <i class="fas fa-calculator"></i>
                    <span>Run Calculation</span>
                </button>
            </div>
        </div>

        <!-- Thermodynamics Tab -->
        <div id="thermodynamics" class="hidden space-y-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <h3 class="text-lg font-semibold mb-4">HTC Steam Cycle (h-s Diagram)</h3>
                    <canvas id="hsChart"></canvas>
                </div>
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <h3 class="text-lg font-semibold mb-4">Gas Brayton Cycle (T-Ḣ Diagram)</h3>
                    <canvas id="thChart"></canvas>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <h3 class="text-lg font-semibold mb-4">Cycle Performance Summary</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="cycle-performance">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Scenarios Tab -->
        <div id="scenarios" class="hidden space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition cursor-pointer" onclick="loadScenario('base_case')">
                    <div class="flex items-center justify-between mb-4">
                        <i class="fas fa-play-circle text-3xl text-blue-500"></i>
                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">Default</span>
                    </div>
                    <h3 class="text-lg font-semibold mb-2">Base Case</h3>
                    <p class="text-gray-600 text-sm mb-4">Standard configuration with typical operating parameters for AD-HTC integration.</p>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between"><span class="text-gray-500">Net Power:</span><span class="font-medium">85 MW</span></div>
                        <div class="flex justify-between"><span class="text-gray-500">Efficiency:</span><span class="font-medium">42%</span></div>
                        <div class="flex justify-between"><span class="text-gray-500">Self-Sufficiency:</span><span class="font-medium">75%</span></div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition cursor-pointer" onclick="loadScenario('optimized')">
                    <div class="flex items-center justify-between mb-4">
                        <i class="fas fa-rocket text-3xl text-green-500"></i>
                        <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm">Optimized</span>
                    </div>
                    <h3 class="text-lg font-semibold mb-2">Optimized Configuration</h3>
                    <p class="text-gray-600 text-sm mb-4">Enhanced parameters for maximum efficiency and sustainability.</p>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between"><span class="text-gray-500">Net Power:</span><span class="font-medium">105 MW</span></div>
                        <div class="flex justify-between"><span class="text-gray-500">Efficiency:</span><span class="font-medium">48%</span></div>
                        <div class="flex justify-between"><span class="text-gray-500">Self-Sufficiency:</span><span class="font-medium">85%</span></div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition cursor-pointer" onclick="loadScenario('full_cogas')">
                    <div class="flex items-center justify-between mb-4">
                        <i class="fas fa-industry text-3xl text-purple-500"></i>
                        <span class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm">Advanced</span>
                    </div>
                    <h3 class="text-lg font-semibold mb-2">Full COGAS Configuration</h3>
                    <p class="text-gray-600 text-sm mb-4">Combined cycle with heat recovery steam generator for maximum output.</p>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between"><span class="text-gray-500">Net Power:</span><span class="font-medium">135 MW</span></div>
                        <div class="flex justify-between"><span class="text-gray-500">Efficiency:</span><span class="font-medium">58%</span></div>
                        <div class="flex justify-between"><span class="text-gray-500">Self-Sufficiency:</span><span class="font-medium">95%</span></div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition cursor-pointer" onclick="loadScenario('minimal_config')">
                    <div class="flex items-center justify-between mb-4">
                        <i class="fas fa-compress-arrows-alt text-3xl text-orange-500"></i>
                        <span class="px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm">Basic</span>
                    </div>
                    <h3 class="text-lg font-semibold mb-2">Minimal Configuration</h3>
                    <p class="text-gray-600 text-sm mb-4">Basic configuration with minimal complexity and lower capital cost.</p>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between"><span class="text-gray-500">Net Power:</span><span class="font-medium">65 MW</span></div>
                        <div class="flex justify-between"><span class="text-gray-500">Efficiency:</span><span class="font-medium">35%</span></div>
                        <div class="flex justify-between"><span class="text-gray-500">Self-Sufficiency:</span><span class="font-medium">60%</span></div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition cursor-pointer" onclick="loadScenario('high_efficiency')">
                    <div class="flex items-center justify-between mb-4">
                        <i class="fas fa-star text-3xl text-yellow-500"></i>
                        <span class="px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full text-sm">Premium</span>
                    </div>
                    <h3 class="text-lg font-semibold mb-2">High Efficiency Focus</h3>
                    <p class="text-gray-600 text-sm mb-4">Maximum efficiency with advanced components and optimized integration.</p>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between"><span class="text-gray-500">Net Power:</span><span class="font-medium">150 MW</span></div>
                        <div class="flex justify-between"><span class="text-gray-500">Efficiency:</span><span class="font-medium">65%</span></div>
                        <div class="flex justify-between"><span class="text-gray-500">Self-Sufficiency:</span><span class="font-medium">105%</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Optimization Tab -->
        <div id="optimization" class="hidden space-y-6">
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <h3 class="text-lg font-semibold mb-4">Multi-Objective Optimization</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Optimization Method</label>
                        <select id="opt-method" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                            <option value="genetic">Genetic Algorithm</option>
                            <option value="gradient">Gradient Descent</option>
                            <option value="pareto">Pareto Frontier</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Primary Objective</label>
                        <select id="opt-objective" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
                            <option value="efficiency">Maximize Efficiency</option>
                            <option value="power">Maximize Power Output</option>
                            <option value="cost">Minimize Cost</option>
                            <option value="sustainability">Maximize Sustainability</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Constraints</label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" class="rounded text-blue-600 mr-2" checked>
                                <span class="text-sm">Min Self-Sufficiency > 70%</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="rounded text-blue-600 mr-2" checked>
                                <span class="text-sm">Max Cost < $1500/kW</span>
                            </label>
                        </div>
                    </div>
                </div>
                <button onclick="runOptimization()" class="w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 transition font-medium">
                    <i class="fas fa-magic mr-2"></i>Run Optimization
                </button>
            </div>

            <div id="optimization-results" class="hidden bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <h3 class="text-lg font-semibold mb-4">Optimization Results</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6" id="opt-results-grid">
                    <!-- Populated by JavaScript -->
                </div>
                <canvas id="paretoChart" class="mt-4"></canvas>
            </div>
        </div>

    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 loading-overlay hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 shadow-2xl text-center">
            <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-gray-600 font-medium">Running simulation...</p>
            <p class="text-sm text-gray-400 mt-2">This may take a few seconds</p>
        </div>
    </div>

    <script>
        // Global state
        let currentResults = null;
        let charts = {};

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initializeCharts();
            loadScenario('base_case');
        });

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            ['dashboard', 'parameters', 'thermodynamics', 'scenarios', 'optimization'].forEach(t => {
                document.getElementById(t).classList.add('hidden');
                document.getElementById(`tab-${t}`).classList.remove('tab-active');
                document.getElementById(`tab-${t}`).classList.add('text-gray-500');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.remove('hidden');
            document.getElementById(`tab-${tabName}`).classList.add('tab-active');
            document.getElementById(`tab-${tabName}`).classList.remove('text-gray-500');
        }

        // Update parameter display values
        function updateParamValue(id, value) {
            document.getElementById(`val-${id}`).textContent = value;
        }

        // Show loading overlay
        function showLoading() {
            document.getElementById('loading-overlay').classList.remove('hidden');
            document.getElementById('loading-overlay').classList.add('flex');
        }

        function hideLoading() {
            document.getElementById('loading-overlay').classList.add('hidden');
            document.getElementById('loading-overlay').classList.remove('flex');
        }

        // Run calculation with current parameters
        async function runCalculation() {
            showLoading();
            
            const params = {
                ambient_temp: parseFloat(document.getElementById('param-ambient-temp').value),
                pressure_ratio: parseFloat(document.getElementById('param-pressure-ratio').value),
                max_turbine_temp: parseFloat(document.getElementById('param-turbine-temp').value),
                compressor_efficiency: parseFloat(document.getElementById('param-comp-eff').value),
                turbine_efficiency: parseFloat(document.getElementById('param-turb-eff').value),
                ad_feedstock_rate: parseFloat(document.getElementById('param-feedstock').value),
                ad_retention_time: parseFloat(document.getElementById('param-retention').value),
                htc_biomass_rate: parseFloat(document.getElementById('param-htc-biomass').value),
                htc_temperature: parseFloat(document.getElementById('param-htc-temp').value)
            };

            try {
                const response = await fetch('http://localhost:8000/calculate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(params)
                });
                
                const data = await response.json();
                currentResults = data;
                updateDashboard(data);
                updateThermodynamicCharts(data);
                
            } catch (error) {
                console.error('Calculation error:', error);
                // Fallback to simulated data for demo
                simulateResults(params);
            } finally {
                hideLoading();
            }
        }

        // Load predefined scenario
        async function loadScenario(scenarioId) {
            showLoading();
            
            try {
                const response = await fetch(`http://localhost:8000/scenarios/${scenarioId}/calculate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                currentResults = data;
                updateDashboard(data);
                updateParameterInputs(data.scenario?.parameters || {});
                
            } catch (error) {
                console.error('Scenario loading error:', error);
                // Fallback simulation
                simulateScenario(scenarioId);
            } finally {
                hideLoading();
            }
        }

        // Update dashboard with results
        function updateDashboard(data) {
            const overall = data.overall_performance || {};
            const gt = data.gas_turbine || {};
            const ad = data.ad_system || {};
            
            // Update metrics
            document.getElementById('metric-power').textContent = 
                (overall.net_power_output_kw || gt.net_work_kw || 0).toFixed(1);
            document.getElementById('metric-efficiency').textContent = 
                ((overall.overall_efficiency || gt.thermal_efficiency || 0) * 100).toFixed(1) + '%';
            document.getElementById('metric-biogas').textContent = 
                (ad.biogas_production_m3_day || 2500).toFixed(0);
            document.getElementById('metric-sufficiency').textContent = 
                ((overall.self_sufficiency_ratio || 0.75) * 100).toFixed(0) + '%';
            
            // Update charts
            updateCharts(data);
        }

        // Update parameter inputs from scenario
        function updateParameterInputs(params) {
            if (params.ambient_temp) document.getElementById('param-ambient-temp').value = params.ambient_temp;
            if (params.pressure_ratio) document.getElementById('param-pressure-ratio').value = params.pressure_ratio;
            if (params.max_turbine_temp) document.getElementById('param-turbine-temp').value = params.max_turbine_temp;
            if (params.compressor_efficiency) document.getElementById('param-comp-eff').value = params.compressor_efficiency;
            if (params.turbine_efficiency) document.getElementById('param-turb-eff').value = params.turbine_efficiency;
            if (params.biomass_rate) document.getElementById('param-feedstock').value = params.biomass_rate;
            if (params.ad_retention_time) document.getElementById('param-retention').value = params.ad_retention_time;
            if (params.htc_reactor_temp) document.getElementById('param-htc-temp').value = params.htc_reactor_temp;
            
            // Update display values
            ['ambient-temp', 'pressure-ratio', 'turbine-temp', 'comp-eff', 'turb-eff', 
             'feedstock', 'retention', 'htc-biomass', 'htc-temp'].forEach(id => {
                const el = document.getElementById(`param-${id}`);
                if (el) updateParamValue(id, el.value);
            });
        }

        // Initialize charts
        function initializeCharts() {
            // Energy Flow Chart
            const ctx1 = document.getElementById('energyFlowChart').getContext('2d');
            charts.energyFlow = new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: ['Electricity Output', 'Heat Recovery', 'HTC Process', 'Losses'],
                    datasets: [{
                        data: [45, 25, 20, 10],
                        backgroundColor: ['#3b82f6', '#f59e0b', '#10b981', '#ef4444']
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });

            // Performance Chart
            const ctx2 = document.getElementById('performanceChart').getContext('2d');
            charts.performance = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: ['Base Case', 'Optimized', 'Full COGAS', 'High Efficiency'],
                    datasets: [{
                        label: 'Efficiency (%)',
                        data: [42, 48, 58, 65],
                        backgroundColor: '#3b82f6'
                    }, {
                        label: 'Self-Sufficiency (%)',
                        data: [75, 85, 95, 105],
                        backgroundColor: '#10b981'
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true, max: 100 } }
                }
            });
        }

        // Update charts with data
        function updateCharts(data) {
            // Update based on actual data
            if (charts.energyFlow && data.energy_flows) {
                charts.energyFlow.data.datasets[0].data = [
                    data.energy_flows.net_electrical_output_kw || 85000,
                    data.energy_flows.gt_exhaust_heat_kw || 40000,
                    data.energy_flows.htc_heat_supply_kw || 20000,
                    15000 // losses
                ];
                charts.energyFlow.update();
            }
        }

        // Update thermodynamic charts
        function updateThermodynamicCharts(data) {
            // h-s Chart for HTC
            const ctxHs = document.getElementById('hsChart');
            if (ctxHs && data.htc_steam_hs) {
                new Chart(ctxHs, {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: 'Steam Cycle',
                            data: data.htc_steam_hs.cycle_path.map(p => ({x: p.s, y: p.h})),
                            borderColor: '#3b82f6',
                            fill: false
                        }, {
                            label: 'Saturation Dome',
                            data: data.htc_steam_hs.dome_curve.map(p => ({x: p.s, y: p.h})),
                            borderColor: '#ef4444',
                            borderDash: [5, 5],
                            fill: false
                        }]
                    },
                    options: {
                        scales: {
                            x: { title: { display: true, text: 'Entropy s (kJ/kg·K)' } },
                            y: { title: { display: true, text: 'Enthalpy h (kJ/kg)' } }
                        }
                    }
                });
            }

            // T-H Chart for Gas Cycle
            const ctxTh = document.getElementById('thChart');
            if (ctxTh && data.gas_cycle_th) {
                const processes = {};
                data.gas_cycle_th.data.forEach(point => {
                    if (!processes[point.process]) processes[point.process] = [];
                    processes[point.process].push({x: point.H_dot, y: point.T});
                });
                
                new Chart(ctxTh, {
                    type: 'line',
                    data: {
                        datasets: Object.keys(processes).map((proc, idx) => ({
                            label: proc,
                            data: processes[proc],
                            borderColor: ['#3b82f6', '#ef4444', '#10b981', '#f59e0b'][idx],
                            fill: false
                        }))
                    },
                    options: {
                        scales: {
                            x: { title: { display: true, text: 'Cumulative Heat Rate Ḣ (kJ/kg)' } },
                            y: { title: { display: true, text: 'Temperature T (K)' } }
                        }
                    }
                });
            }
        }

        // Run optimization
        async function runOptimization() {
            showLoading();
            
            const objectives = {
                maximize: ['efficiency', 'power_output'],
                minimize: ['specific_cost'],
                weights: { efficiency: 0.4, power_output: 0.3, specific_cost: 0.3 }
            };
            
            try {
                const response = await fetch('http://localhost:8000/optimize', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ objectives, method: document.getElementById('opt-method').value })
                });
                
                const data = await response.json();
                displayOptimizationResults(data);
                
            } catch (error) {
                console.error('Optimization error:', error);
                simulateOptimization();
            } finally {
                hideLoading();
            }
        }

        function displayOptimizationResults(data) {
            document.getElementById('optimization-results').classList.remove('hidden');
            // Populate results...
        }

        // Simulation fallbacks for demo
        function simulateResults(params) {
            const efficiency = 0.35 + (params.pressure_ratio - 6) * 0.01 + (params.max_turbine_temp - 1000) * 0.0001;
            const power = 100000 * (efficiency / 0.35);
            
            updateDashboard({
                overall_performance: {
                    net_power_output_kw: power,
                    overall_efficiency: efficiency,
                    self_sufficiency_ratio: 0.75
                },
                gas_turbine: { net_work_kw: power, thermal_efficiency: efficiency },
                ad_system: { biogas_production_m3_day: params.ad_feedstock_rate * 0.8 }
            });
        }

        function simulateScenario(scenarioId) {
            const scenarios = {
                base_case: { power: 85000, efficiency: 0.42, biogas: 2500, sufficiency: 0.75 },
                optimized: { power: 105000, efficiency: 0.48, biogas: 3200, sufficiency: 0.85 },
                full_cogas: { power: 135000, efficiency: 0.58, biogas: 3800, sufficiency: 0.95 },
                minimal_config: { power: 65000, efficiency: 0.35, biogas: 1800, sufficiency: 0.60 },
                high_efficiency: { power: 150000, efficiency: 0.65, biogas: 4200, sufficiency: 1.05 }
            };
            
            const s = scenarios[scenarioId] || scenarios.base_case;
            updateDashboard({
                overall_performance: {
                    net_power_output_kw: s.power,
                    overall_efficiency: s.efficiency,
                    self_sufficiency_ratio: s.sufficiency
                },
                gas_turbine: { net_work_kw: s.power, thermal_efficiency: s.efficiency },
                ad_system: { biogas_production_m3_day: s.biogas }
            });
        }

        function showDetails(component) {
            alert(`Details for ${component} - In production, this would show detailed operational data.`);
        }

        function exportResults() {
            if (!currentResults) {
                alert('Please run a calculation first');
                return;
            }
            const dataStr = JSON.stringify(currentResults, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `ad-htc-results-${new Date().toISOString().slice(0,10)}.json`;
            link.click();
        }
    </script>
</body>
</html>